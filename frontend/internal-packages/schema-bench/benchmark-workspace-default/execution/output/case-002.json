{
  "tables": {
    "customers": {
      "name": "customers",
      "columns": {
        "customer_id": {
          "name": "customer_id",
          "type": "bigint",
          "default": "auto_increment",
          "check": null,
          "notNull": true,
          "comment": "Surrogate primary key"
        },
        "customer_number": {
          "name": "customer_number",
          "type": "varchar(50)",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "Business key provided by company; unique"
        },
        "name": {
          "name": "name",
          "type": "varchar(255)",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "Customer full name"
        },
        "phone_number": {
          "name": "phone_number",
          "type": "varchar(30)",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "Primary contact phone"
        },
        "address": {
          "name": "address",
          "type": "text",
          "default": null,
          "check": null,
          "notNull": false,
          "comment": "Mailing address"
        },
        "email": {
          "name": "email",
          "type": "varchar(255)",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "Customer email; unique"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP",
          "check": null,
          "notNull": true,
          "comment": "Row creation time"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP",
          "check": null,
          "notNull": true,
          "comment": "Row update time"
        }
      },
      "comment": "Customer master data",
      "indexes": {},
      "constraints": {
        "primary_key": {
          "type": "PRIMARY KEY",
          "name": "pk_customers",
          "columnNames": [
            "customer_id"
          ]
        },
        "unique": {
          "type": "UNIQUE",
          "name": "uq_customers_customer_number",
          "columnNames": [
            "customer_number"
          ]
        },
        "unique_2": {
          "type": "UNIQUE",
          "name": "uq_customers_email",
          "columnNames": [
            "email"
          ]
        }
      }
    },
    "personnel": {
      "name": "personnel",
      "columns": {
        "personnel_id": {
          "name": "personnel_id",
          "type": "bigint",
          "default": "auto_increment",
          "check": null,
          "notNull": true,
          "comment": "Surrogate primary key"
        },
        "employee_number": {
          "name": "employee_number",
          "type": "varchar(50)",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "Company-assigned unique personnel number"
        },
        "name": {
          "name": "name",
          "type": "varchar(255)",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "Personnel name"
        },
        "email": {
          "name": "email",
          "type": "varchar(255)",
          "default": null,
          "check": null,
          "notNull": false,
          "comment": "Personnel email"
        },
        "phone_number": {
          "name": "phone_number",
          "type": "varchar(30)",
          "default": null,
          "check": null,
          "notNull": false,
          "comment": "Personnel phone"
        }
      },
      "comment": "Operating personnel who perform subscription/cancellation operations",
      "indexes": {},
      "constraints": {
        "primary_key": {
          "type": "PRIMARY KEY",
          "name": "pk_personnel",
          "columnNames": [
            "personnel_id"
          ]
        },
        "unique": {
          "type": "UNIQUE",
          "name": "uq_personnel_employee_number",
          "columnNames": [
            "employee_number"
          ]
        }
      }
    },
    "service_plans": {
      "name": "service_plans",
      "columns": {
        "plan_id": {
          "name": "plan_id",
          "type": "bigint",
          "default": "auto_increment",
          "check": null,
          "notNull": true,
          "comment": "Surrogate primary key"
        },
        "plan_number": {
          "name": "plan_number",
          "type": "varchar(50)",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "Unique plan number"
        },
        "name": {
          "name": "name",
          "type": "varchar(255)",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "Plan name"
        },
        "price": {
          "name": "price",
          "type": "decimal(10,2)",
          "default": "0.00",
          "check": "price >= 0",
          "notNull": true,
          "comment": "Recurring price for the plan"
        },
        "description": {
          "name": "description",
          "type": "text",
          "default": null,
          "check": null,
          "notNull": false,
          "comment": "Optional description of the plan"
        }
      },
      "comment": "Catalog of service plans",
      "indexes": {},
      "constraints": {
        "primary_key": {
          "type": "PRIMARY KEY",
          "name": "pk_service_plans",
          "columnNames": [
            "plan_id"
          ]
        },
        "unique": {
          "type": "UNIQUE",
          "name": "uq_service_plans_plan_number",
          "columnNames": [
            "plan_number"
          ]
        }
      }
    },
    "services": {
      "name": "services",
      "columns": {
        "service_id": {
          "name": "service_id",
          "type": "bigint",
          "default": "auto_increment",
          "check": null,
          "notNull": true,
          "comment": "Surrogate primary key"
        },
        "service_code": {
          "name": "service_code",
          "type": "varchar(50)",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "Unique service code"
        },
        "name": {
          "name": "name",
          "type": "varchar(255)",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "Service name"
        },
        "description": {
          "name": "description",
          "type": "text",
          "default": null,
          "check": null,
          "notNull": false,
          "comment": "Service description"
        }
      },
      "comment": "Atomic services that can be included in plans",
      "indexes": {},
      "constraints": {
        "primary_key": {
          "type": "PRIMARY KEY",
          "name": "pk_services",
          "columnNames": [
            "service_id"
          ]
        },
        "unique": {
          "type": "UNIQUE",
          "name": "uq_services_service_code",
          "columnNames": [
            "service_code"
          ]
        }
      }
    },
    "plan_included_services": {
      "name": "plan_included_services",
      "columns": {
        "plan_id": {
          "name": "plan_id",
          "type": "bigint",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "FK to service_plans.plan_id"
        },
        "service_id": {
          "name": "service_id",
          "type": "bigint",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "FK to services.service_id"
        }
      },
      "comment": "Join table enumerating which services are included in each plan",
      "indexes": {},
      "constraints": {
        "primary_key": {
          "type": "PRIMARY KEY",
          "name": "pk_plan_included_services",
          "columnNames": [
            "plan_id",
            "service_id"
          ]
        },
        "fk_plan": {
          "type": "FOREIGN KEY",
          "name": "fk_pis_plan",
          "columnNames": [
            "plan_id"
          ],
          "targetTableName": "service_plans",
          "targetColumnNames": [
            "plan_id"
          ],
          "updateConstraint": "CASCADE",
          "deleteConstraint": "CASCADE"
        },
        "fk_service": {
          "type": "FOREIGN KEY",
          "name": "fk_pis_service",
          "columnNames": [
            "service_id"
          ],
          "targetTableName": "services",
          "targetColumnNames": [
            "service_id"
          ],
          "updateConstraint": "CASCADE",
          "deleteConstraint": "RESTRICT"
        }
      }
    },
    "customer_plan_subscriptions": {
      "name": "customer_plan_subscriptions",
      "columns": {
        "subscription_id": {
          "name": "subscription_id",
          "type": "bigint",
          "default": "auto_increment",
          "check": null,
          "notNull": true,
          "comment": "Surrogate primary key"
        },
        "customer_id": {
          "name": "customer_id",
          "type": "bigint",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "FK to customers.customer_id"
        },
        "plan_id": {
          "name": "plan_id",
          "type": "bigint",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "FK to service_plans.plan_id"
        },
        "subscription_time": {
          "name": "subscription_time",
          "type": "timestamp",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "Time when the customer subscribed to the plan"
        },
        "subscribed_by_personnel_id": {
          "name": "subscribed_by_personnel_id",
          "type": "bigint",
          "default": null,
          "check": null,
          "notNull": true,
          "comment": "FK to personnel.personnel_id who performed the subscription"
        },
        "cancellation_time": {
          "name": "cancellation_time",
          "type": "timestamp",
          "default": null,
          "check": null,
          "notNull": false,
          "comment": "Time when the subscription was cancelled (NULL if active)"
        },
        "cancelled_by_personnel_id": {
          "name": "cancelled_by_personnel_id",
          "type": "bigint",
          "default": null,
          "check": null,
          "notNull": false,
          "comment": "FK to personnel.personnel_id who performed the cancellation (NULL if not cancelled)"
        },
        "notes": {
          "name": "notes",
          "type": "text",
          "default": null,
          "check": null,
          "notNull": false,
          "comment": "Optional operational notes"
        }
      },
      "comment": "Tracks each subscribe/unsubscribe lifecycle for a customer-plan pair",
      "indexes": {},
      "constraints": {
        "primary_key": {
          "type": "PRIMARY KEY",
          "name": "pk_customer_plan_subscriptions",
          "columnNames": [
            "subscription_id"
          ]
        },
        "fk_customer": {
          "type": "FOREIGN KEY",
          "name": "fk_cps_customer",
          "columnNames": [
            "customer_id"
          ],
          "targetTableName": "customers",
          "targetColumnNames": [
            "customer_id"
          ],
          "updateConstraint": "CASCADE",
          "deleteConstraint": "RESTRICT"
        },
        "fk_plan": {
          "type": "FOREIGN KEY",
          "name": "fk_cps_plan",
          "columnNames": [
            "plan_id"
          ],
          "targetTableName": "service_plans",
          "targetColumnNames": [
            "plan_id"
          ],
          "updateConstraint": "CASCADE",
          "deleteConstraint": "RESTRICT"
        },
        "fk_subscribed_by": {
          "type": "FOREIGN KEY",
          "name": "fk_cps_subscribed_by",
          "columnNames": [
            "subscribed_by_personnel_id"
          ],
          "targetTableName": "personnel",
          "targetColumnNames": [
            "personnel_id"
          ],
          "updateConstraint": "CASCADE",
          "deleteConstraint": "RESTRICT"
        },
        "fk_cancelled_by": {
          "type": "FOREIGN KEY",
          "name": "fk_cps_cancelled_by",
          "columnNames": [
            "cancelled_by_personnel_id"
          ],
          "targetTableName": "personnel",
          "targetColumnNames": [
            "personnel_id"
          ],
          "updateConstraint": "CASCADE",
          "deleteConstraint": "SET_NULL"
        },
        "chk_cancel_after_subscribe": {
          "type": "CHECK",
          "name": "chk_cps_cancel_after_subscribe",
          "detail": "cancellation_time IS NULL OR cancellation_time >= subscription_time"
        },
        "uq_active_one_per_plan": {
          "type": "UNIQUE",
          "name": "uq_cps_active_one_per_plan",
          "columnNames": [
            "customer_id",
            "plan_id",
            "cancellation_time_is_null_partial_index_placeholder"
          ]
        }
      }
    }
  }
}